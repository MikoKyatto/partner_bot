# Исправление проблемы с админом

## Проблема
Пользователь с ID 1454702347 не распознавался как админ, хотя должен был быть.

## Причина
Переменные окружения читались при импорте модулей, до того как `load_dotenv()` загружал файл `.env`.

## Исправления

### 1. Обновлен handlers/admin.py
- Заменены глобальные переменные на функции
- `get_admin_user_id()` - получает ID админа из окружения
- `get_admin_group_id()` - получает ID группы из окружения
- `is_admin()` - проверяет, является ли пользователь админом

### 2. Обновлен handlers/start.py
- Заменена глобальная переменная на функцию
- `get_admin_group_id()` - получает ID группы из окружения

### 3. Создан скрипт запуска run_bot.sh
- Загружает переменные окружения из .env
- Запускает бота с правильной конфигурацией

## Как запустить бота

### Вариант 1: Через скрипт (рекомендуется)
```bash
./run_bot.sh
```

### Вариант 2: Вручную
```bash
export $(cat .env | xargs) && python3 main.py
```

### Вариант 3: Docker
```bash
docker-compose up --build
```

## Проверка конфигурации

Запустите тест для проверки:
```bash
export $(cat .env | xargs) && python3 test_admin_simple.py
```

Должно показать:
```
ADMIN_USER_ID from env: 1454702347
ADMIN_GROUP_ID from env: -1003016595712
Is user 1454702347 admin? True
```

## Файл .env
Убедитесь, что файл `.env` содержит:
```
BOT_TOKEN=8320091798:AAHIah-pmIj5zxIX83H8NmTFhVHgk5jAmrI
SHEETS_ID=18dY652fOqEJ6EC1ppMlMF0Obzlzu32xxVXt5AJ9415A
CREDENTIALS_PATH=credentials.json
ADMIN_GROUP_ID=-1003016595712
ADMIN_USER_ID=1454702347
```

## Тестирование админ функций

После запуска бота:
1. Отправьте `/admin` от пользователя 1454702347
2. Должен открыться админ панель
3. Проверьте логи на наличие сообщений о проверке админ статуса

## Логи
В логах должно быть:
```
INFO - Checking admin status for user 1454702347, admin ID is 1454702347
INFO - User 1454702347 admin status: True
```

Если статус False, проверьте переменные окружения.



